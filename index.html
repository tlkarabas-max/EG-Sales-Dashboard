<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Performance Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f0f2f5; }
    .header { background: white; padding: 15px 30px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
    .header h1 { font-size: 24px; font-weight: 600; }
    .login-container { max-width: 900px; margin: 100px auto; padding: 20px; }
    .login-header { text-align: center; margin-bottom: 40px; }
    .login-header h2 { font-size: 32px; color: #333; }
    .login-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; max-width: 800px; margin: 0 auto; }
    .login-box { background: white; padding: 40px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); text-align: center; }
    .login-box h3 { color: #007bff; font-size: 24px; margin-bottom: 10px; }
    .login-box p { color: #6c757d; margin-bottom: 30px; font-size: 14px; }
    .login-form { display: flex; flex-direction: column; gap: 15px; }
    .login-form input, .login-form select { padding: 12px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px; width: 100%; }
    .login-btn { padding: 12px; border: none; border-radius: 6px; font-size: 16px; font-weight: 500; cursor: pointer; color: white; transition: all 0.3s; }
    .staff-login-btn { background: #28a745; }
    .staff-login-btn:hover { background: #218838; }
    .admin-login-btn { background: #007bff; }
    .admin-login-btn:hover { background: #0056b3; }
    .logout-btn { background: white; color: #dc3545; border: 1px solid #dc3545; padding: 8px 20px; border-radius: 5px; cursor: pointer; font-size: 14px; }
    .logout-btn:hover { background: #dc3545; color: white; }
    .hidden { display: none !important; }
    .notification { position: fixed; top: 20px; right: 20px; padding: 15px 20px; border-radius: 5px; z-index: 10000; box-shadow: 0 4px 12px rgba(0,0,0,0.15); max-width: 350px; animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }
    .notification.success { background: #28a745; color: white; }
    .notification.error { background: #dc3545; color: white; }
    .staff-container { padding: 30px; max-width: 1400px; margin: 0 auto; }
    
    /* Enhanced Staff Dashboard Styles */
    .welcome-section { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .period-selector-staff { margin-top: 10px; padding: 8px 16px; border-radius: 5px; border: 1px solid #ddd; font-size: 14px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 20px; }
    .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); text-align: center; transition: transform 0.3s; position: relative; }
    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
    .stat-label { color: #666; font-size: 12px; text-transform: uppercase; margin-bottom: 10px; font-weight: 600; }
    .stat-value { font-size: 48px; font-weight: bold; color: #007bff; margin-bottom: 10px; }
    .stat-goal { font-size: 14px; color: #666; margin-bottom: 15px; }
    .status-badge { padding: 4px 8px; border-radius: 15px; font-size: 12px; font-weight: 600; display: inline-block; margin-bottom: 10px; color: white; }
    .status-green { background: #28a745; }
    .status-yellow { background: #ffc107; color: #333; }
    .status-red { background: #dc3545; }
    
    /* Metric displays */
    .metric-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 13px; }
    .metric-label { color: #666; }
    .metric-value { font-weight: 600; color: #333; }
    .hours-indicator { position: absolute; top: 10px; right: 10px; background: #e3f2fd; color: #1976d2; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
    
    .comparison-table { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .comparison-table h3 { color: #333; margin-bottom: 15px; font-size: 18px; }
    .comparison-table table { width: 100%; border-collapse: collapse; font-size: 14px; }
    .comparison-table th { padding: 10px; text-align: left; border: 1px solid #dee2e6; font-weight: 600; background: #f8f9fa; }
    .comparison-table td { padding: 10px; border: 1px solid #dee2e6; text-align: center; }
    .user-row { background: #e3f2fd; font-weight: bold; }
    
    .bonus-section { background: linear-gradient(135deg, #374151, #4b5563); color: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
    .bonus-total { font-size: 36px; font-weight: bold; margin-bottom: 20px; }
    .bonus-breakdown { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
    .bonus-item { background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; text-align: center; }
    
    .tips-section { background: #e3f2fd; padding: 20px; border-radius: 10px; border-left: 4px solid #2196f3; }
    .tips-section h3 { color: #1976d2; margin-bottom: 10px; font-size: 16px; }
    .tips-section ul { list-style: none; padding: 0; }
    .tips-section li { padding: 5px 0; color: #555; font-size: 14px; }
    .tips-section li:before { content: "✓ "; color: #1976d2; font-weight: bold; margin-right: 8px; }
    
    /* Admin Dashboard Styles */
    .admin-container { padding: 30px; max-width: 1400px; margin: 0 auto; }
    .admin-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .admin-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .admin-card h3 { color: #333; margin-bottom: 15px; font-size: 18px; }
    .team-table { width: 100%; border-collapse: collapse; }
    .team-table th { padding: 12px; text-align: left; background: #f8f9fa; border-bottom: 2px solid #dee2e6; font-size: 13px; }
    .team-table td { padding: 12px; border-bottom: 1px solid #dee2e6; font-size: 13px; }
    .performance-bar { height: 8px; background: #e9ecef; border-radius: 4px; overflow: hidden; }
    .performance-fill { height: 100%; background: #28a745; transition: width 0.3s; }
    
    @media (max-width: 768px) {
      .login-grid { grid-template-columns: 1fr; }
      .stats-grid { grid-template-columns: 1fr; }
      .bonus-breakdown { grid-template-columns: 1fr; }
    }

    /* Quick Actions Panel */
    .quick-actions {
      position: fixed;
      right: 20px;
      bottom: 20px;
      background: white;
      padding: 15px;
      border-radius: 15px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .quick-actions-header {
      cursor: pointer;
      text-align: center;
      font-size: 20px;
      margin-bottom: 10px;
    }

    .quick-actions-buttons {
      display: flex;
      gap: 10px;
    }

    .quick-action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 10px;
      border: none;
      background: #f0f2f5;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      min-width: 60px;
    }

    .action-icon { font-size: 24px; margin-bottom: 4px; }
    .action-label { font-size: 11px; color: #666; font-weight: 600; }
  </style>
</head>
<body>
  <div id="loginSection">
    <div class="header">
      <h1>Performance Dashboard</h1>
    </div>
    <div class="login-container">
      <div class="login-header">
        <h2>Performance Dashboard Login</h2>
      </div>
      <div class="login-grid">
        <div class="login-box">
          <h3>Staff Login</h3>
          <p>Experience Guides - Access your personal dashboard</p>
          <div class="login-form">
            <select id="staffSelect">
              <option value="">Select your name...</option>
              <option value="Angela McNally">Angela McNally</option>
              <option value="Anna Mercadante">Anna Mercadante</option>
              <option value="Madison Jeske">Madison Jeske</option>
              <option value="Di Fisher">Di Fisher</option>
              <option value="Edward Franklin">Edward Franklin</option>
              <option value="Jessica Watts">Jessica Watts</option>
            </select>
            <input type="password" id="staffPassword" placeholder="Enter your Staff ID">
            <button class="login-btn staff-login-btn" onclick="loginStaff()">Login as Staff</button>
          </div>
        </div>
        <div class="login-box">
          <h3>Admin Login</h3>
          <p>Managers - Access all dashboards and reports</p>
          <div class="login-form">
            <input type="password" id="adminPassword" placeholder="Enter admin password">
            <button class="login-btn admin-login-btn" onclick="loginAdmin()">Login as Admin</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div id="staffView" class="hidden">
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; color: white; text-align: center;">
      <h1 style="margin: 0; font-size: 22px; font-weight: 400;">Welcome, <span id="staffName">Angela McNally</span>!</h1>
      <p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.95;">Your Performance for Current Period</p>
    </div>
    
    <div style="padding: 20px; max-width: 500px; margin: 0 auto; background: #f5f5f7;">
      <!-- Performance Cards Grid -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
        <!-- Enhancements Card -->
        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 24px; margin-right: 10px;">🎯</span>
            <span style="color: #ff6b35; font-size: 11px; font-weight: 600; text-transform: uppercase;">Enhancements</span>
          </div>
          <div style="font-size: 36px; font-weight: 700; color: #333; margin-bottom: 4px;" id="enhanceValue">12</div>
          <div style="font-size: 12px; color: #666; margin-bottom: 12px;">Goal: <span id="enhanceAdjusted">15</span></div>
          <div style="background: #28a745; color: white; padding: 8px; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 500;">
            Goal Met!
          </div>
        </div>

        <!-- Memberships Card -->
        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 24px; margin-right: 10px;">💎</span>
            <span style="color: #17a2b8; font-size: 11px; font-weight: 600; text-transform: uppercase;">Memberships</span>
          </div>
          <div style="font-size: 36px; font-weight: 700; color: #333; margin-bottom: 4px;" id="memberValue">4</div>
          <div style="font-size: 12px; color: #666; margin-bottom: 12px;">Target: <span id="convGoal">3</span></div>
          <div style="background: #28a745; color: white; padding: 8px; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 500;">
            Goal Exceeded!
          </div>
        </div>

        <!-- Rebook Rate Card -->
        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 24px; margin-right: 10px;">📅</span>
            <span style="color: #6f42c1; font-size: 11px; font-weight: 600; text-transform: uppercase;">Rebook Rate</span>
          </div>
          <div style="font-size: 36px; font-weight: 700; color: #333; margin-bottom: 4px;" id="rebookValue">42%</div>
          <div style="font-size: 12px; color: #666; margin-bottom: 12px;">Target: 20%</div>
          <div style="background: #28a745; color: white; padding: 8px; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 500;">
            Excellent Work!
          </div>
        </div>

        <!-- Performance Score Card -->
        <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 24px; margin-right: 10px;">⭐</span>
            <span style="color: #ffc107; font-size: 11px; font-weight: 600; text-transform: uppercase;">Overall Performance</span>
          </div>
          <div style="font-size: 36px; font-weight: 700; color: #333; margin-bottom: 4px;" id="overallValue">70%</div>
          <div style="font-size: 12px; color: #666; margin-bottom: 12px;">Performance Score</div>
          <div style="background: #ffc107; color: #333; padding: 8px; border-radius: 8px; text-align: center; font-size: 13px; font-weight: 500;">
            Keep up the good work!
          </div>
        </div>
      </div>

      <!-- Team Comparison Section -->
      <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px;">
        <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center;">
          <span style="font-size: 20px; margin-right: 8px;">🏆</span>
          Anonymous Team Comparison
        </h3>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="border-bottom: 2px solid #f0f0f0;">
              <th style="text-align: left; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Team Member</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Enhance</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Members</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Rebook %</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Score</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Rank</th>
            </tr>
          </thead>
          <tbody>
            <tr style="background: #e3f2fd; font-weight: 600;">
              <td style="padding: 10px; font-size: 14px;">You</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="yourEnhance">94</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="yourMembers">8</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="yourRebook">42%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="yourScore">100%</td>
              <td style="padding: 10px; text-align: center; font-size: 20px;" id="yourRank">🥉</td>
            </tr>
            <tr style="border-bottom: 1px solid #f0f0f0;">
              <td style="padding: 10px; font-size: 14px;">Team Member 1</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm1Enhance">119</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm1Members">3</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm1Rebook">35%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm1Score">100%</td>
              <td style="padding: 10px; text-align: center; font-size: 20px;" id="tm1Rank">🥇</td>
            </tr>
            <tr style="border-bottom: 1px solid #f0f0f0;">
              <td style="padding: 10px; font-size: 14px;">Team Member 2</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm2Enhance">96</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm2Members">13</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm2Rebook">38%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm2Score">100%</td>
              <td style="padding: 10px; text-align: center; font-size: 20px;" id="tm2Rank">🥈</td>
            </tr>
            <tr style="border-bottom: 1px solid #f0f0f0;">
              <td style="padding: 10px; font-size: 14px;">Team Member 3</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm3Enhance">67</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm3Members">7</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm3Rebook">35%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm3Score">100%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm3Rank">4</td>
            </tr>
            <tr style="border-bottom: 1px solid #f0f0f0;">
              <td style="padding: 10px; font-size: 14px;">Team Member 4</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm4Enhance">45</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm4Members">1</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm4Rebook">25%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm4Score">98%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm4Rank">5</td>
            </tr>
            <tr>
              <td style="padding: 10px; font-size: 14px;">Team Member 5</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm5Enhance">7</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm5Members">1</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm5Rebook">5%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm5Score">59%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;" id="tm5Rank">6</td>
            </tr>
          </tbody>
        </table>
        <p style="margin: 15px 0 0 0; font-size: 12px; color: #666; text-align: center;">
          🔒 Must not be disclosed, this is to show your spot only for team metrics!
        </p>
      </div>

      <!-- Period Comparison -->
      <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); margin-bottom: 20px;">
        <h3 style="margin: 0 0 15px 0; font-size: 16px; font-weight: 600; display: flex; align-items: center;">
          <span style="font-size: 20px; margin-right: 8px;">📊</span>
          Period Comparison
        </h3>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="border-bottom: 2px solid #f0f0f0;">
              <th style="text-align: left; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Period</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Enhance</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Members</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Rebook</th>
              <th style="text-align: center; padding: 8px; font-size: 11px; font-weight: 600; color: #666; text-transform: uppercase;">Bonus</th>
            </tr>
          </thead>
          <tbody>
            <tr style="border-bottom: 1px solid #f0f0f0;">
              <td style="padding: 10px; font-size: 14px;">Current (Aug 24 - Sep 6)</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;">12</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;">4</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;">42%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px; font-weight: 600;">$95.40</td>
            </tr>
            <tr>
              <td style="padding: 10px; font-size: 14px;">Previous (Aug 10-23)</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;">10</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;">3</td>
              <td style="padding: 10px; text-align: center; font-size: 14px;">38%</td>
              <td style="padding: 10px; text-align: center; font-size: 14px; font-weight: 600;">$73.20</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Bonus Earnings Section -->
      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; padding: 20px; color: white; text-align: center; margin-bottom: 20px;">
        <h3 style="margin: 0 0 5px 0; font-size: 16px; font-weight: 400; display: flex; align-items: center; justify-content: center;">
          <span style="font-size: 20px; margin-right: 8px;">💰</span>
          My Bonus Earnings - Current Period
        </h3>
        <div style="font-size: 42px; font-weight: 700; margin: 15px 0;" id="totalBonus">$95.40</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-top: 20px;">
          <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px;">
            <div style="font-size: 11px; text-transform: uppercase; opacity: 0.8; margin-bottom: 5px;">Enhancement</div>
            <div style="font-size: 20px; font-weight: 600;" id="enhanceBonus">$8.40</div>
          </div>
          <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px;">
            <div style="font-size: 11px; text-transform: uppercase; opacity: 0.8; margin-bottom: 5px;">Membership</div>
            <div style="font-size: 20px; font-weight: 600;" id="membershipBonus">$40.00</div>
          </div>
          <div style="background: rgba(255,255,255,0.15); padding: 12px; border-radius: 8px;">
            <div style="font-size: 11px; text-transform: uppercase; opacity: 0.8; margin-bottom: 5px;">Top Bonus</div>
            <div style="font-size: 20px; font-weight: 600;">$47.00</div>
          </div>
        </div>
      </div>

      <!-- Logout Button -->
      <div style="text-align: center; margin-top: 30px;">
        <button onclick="logout()" style="background: white; color: #667eea; border: 2px solid #667eea; padding: 12px 40px; border-radius: 25px; font-size: 14px; font-weight: 600; cursor: pointer;">
          Logout
        </button>
      </div>
    </div>
  </div>

  <div id="adminView" class="hidden">
    <div class="header">
      <h1>Admin Dashboard - Team Overview</h1>
      <div style="display: flex; gap: 10px; align-items: center;">
        <select id="periodSelector" onchange="changePeriod()" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd;">
          <option value="current">Sep 7-20, 2025 (Current)</option>
          <option value="aug24">Aug 24 - Sep 6, 2025</option>
          <option value="aug10">Aug 10-23, 2025</option>
          <option value="jul27">Jul 27 - Aug 9, 2025</option>
          <option value="sep21">Sep 21 - Oct 4, 2025 (Future)</option>
          <option value="oct5">Oct 5-18, 2025 (Future)</option>
        </select>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>
    
    <div class="admin-container">
      <div class="admin-grid">
        <div class="admin-card">
          <h3>Team Summary</h3>
          <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Total Staff:</span>
            <strong>6</strong>
          </div>
          <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Total Hours:</span>
            <strong id="totalHours">0</strong>
          </div>
          <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Avg Conversion:</span>
            <strong id="avgConvAdmin">0%</strong>
          </div>
        </div>
        
        <div class="admin-card">
          <h3>Top Performers</h3>
          <ol id="topPerformers" style="padding-left: 20px;">
            <li>Loading...</li>
          </ol>
        </div>
        
        <div class="admin-card">
          <h3>Total Bonuses</h3>
          <div style="font-size: 32px; font-weight: bold; color: #4a5568; text-align: center; margin: 20px 0;">
            <span id="totalTeamBonus">$0.00</span>
          </div>
        </div>
        
        <div class="admin-card">
          <h3>Eligible Guests Summary</h3>
          <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Total Eligible (Non-Members):</span>
            <strong id="totalEligible">0</strong>
          </div>
          <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Goal Conversions (25%):</span>
            <strong id="goalConversions">0</strong>
          </div>
          <div style="display: flex; justify-content: space-between; margin: 10px 0;">
            <span>Actual Conversions:</span>
            <strong id="actualConversions">0</strong>
          </div>
        </div>
      </div>
      
      <div class="admin-card">
        <h3>Full Team Performance</h3>
        <table class="team-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Hours</th>
              <th>Members</th>
              <th>Conv %</th>
              <th>Goal Rate</th>
              <th>Enhance</th>
              <th>Enh Goal</th>
              <th>Rebook Goal</th>
              <th>Rebook</th>
              <th>Bonus</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody id="teamTableBody">
            <tr>
              <td colspan="11" style="text-align: center;">Loading...</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="admin-card" style="margin-top: 20px;">
        <h3>Data Management Center</h3>
        
        <!-- Data Status Indicator -->
        <div style="background: #f0f9ff; border-left: 4px solid #3b82f6; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px 0; color: #1e40af; font-size: 14px;">📊 Data Status</h4>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 13px;">
            <div>Sales: <span id="salesStatus" style="color: #dc2626;">❌ Not loaded</span></div>
            <div>Memberships: <span id="membershipStatus" style="color: #dc2626;">❌ Not loaded</span></div>
            <div>OOT: <span id="ootStatus" style="color: #dc2626;">❌ Not loaded</span></div>
            <div>Appointments: <span id="appointmentStatus" style="color: #dc2626;">❌ Not loaded</span></div>
            <div>Bonus: <span id="bonusStatus" style="color: #dc2626;">❌ Not loaded</span></div>
            <div>Payroll: <span id="payrollStatus" style="color: #dc2626;">❌ Not loaded</span></div>
          </div>
          <div style="margin-top: 10px; font-size: 12px; color: #6b7280;">
            <strong>Note:</strong> Data remains loaded until you refresh the page. Changing periods uses the same uploaded data.
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <h4>Import Data Files</h4>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <button onclick="document.getElementById('salesFile').click()" 
                      style="background: white; color: #495057; border: 1px solid #ced4da; 
                             padding: 10px 15px; border-radius: 6px; cursor: pointer;">
                📊 Sales Data
              </button>
              <input type="file" id="salesFile" accept=".csv" style="display: none;" 
                     onchange="handleSalesUpload(event)">
              
              <button onclick="document.getElementById('membershipFile').click()" 
                      style="background: white; color: #495057; border: 1px solid #ced4da; 
                             padding: 10px 15px; border-radius: 6px; cursor: pointer;">
                👥 Membership Data
              </button>
              <input type="file" id="membershipFile" accept=".csv" style="display: none;" 
                     onchange="handleMembershipUpload(event)">
              
              <button onclick="document.getElementById('ootFile').click()" 
                      style="background: white; color: #495057; border: 1px solid #ced4da; 
                             padding: 10px 15px; border-radius: 6px; cursor: pointer;">
                🌍 OOT Data
              </button>
              <input type="file" id="ootFile" accept=".csv" style="display: none;" 
                     onchange="handleOOTUpload(event)">
              
              <button onclick="document.getElementById('appointmentsFile').click()" 
                      style="background: white; color: #495057; border: 1px solid #ced4da; 
                             padding: 10px 15px; border-radius: 6px; cursor: pointer;">
                📅 Appointments
              </button>
              <input type="file" id="appointmentsFile" accept=".csv" style="display: none;" 
                     onchange="handleAppointmentsUpload(event)">
              
              <button onclick="document.getElementById('bonusFile').click()" 
                      style="background: white; color: #495057; border: 1px solid #ced4da; 
                             padding: 10px 15px; border-radius: 6px; cursor: pointer;">
                💰 Bonus Upload
              </button>
              <input type="file" id="bonusFile" accept=".csv" style="display: none;" 
                     onchange="handleBonusUpload(event)">
              
              <button onclick="document.getElementById('payrollFile').click()" 
                      style="background: white; color: #495057; border: 1px solid #ced4da; 
                             padding: 10px 15px; border-radius: 6px; cursor: pointer;">
                💳 Payroll Data
              </button>
              <input type="file" id="payrollFile" accept=".csv" style="display: none;" 
                     onchange="handlePayrollUpload(event)">
            </div>
          </div>
          
          <div style="background: #f8f9fa; padding: 20px; border-radius: 8px;">
            <h4>Update Data</h4>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
              <button onclick="updateMembershipCounts()" 
                      style="background: #ff6b35; color: white; border: none;
                             padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                👥 Update Memberships
              </button>
              
              <button onclick="updateEnhancementCounts()" 
                      style="background: #20c997; color: white; border: none;
                             padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                ✨ Update Enhancements
              </button>
              
              <button onclick="updateRebookRates()" 
                      style="background: #17a2b8; color: white; border: none;
                             padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                🔄 Update Rebooks
              </button>
              
              <button onclick="updatePayrollHours()" 
                      style="background: #ffc107; color: #333; border: none;
                             padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                ⏰ Update Hours
              </button>
            </div>
            
            <div style="margin-top: 10px;">
              <button onclick="openAdvancedStaffManager()" 
                      style="background: #007bff; color: white; border: none;
                             padding: 12px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; width: 100%;">
                👤 Manage Active Staff
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Advanced Staff Manager Popup -->
  <div id="advancedStaffManager" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 10000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); width: 600px; max-height: 80vh; overflow-y: auto;">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
        <h3 style="margin: 0; color: #007bff; font-size: 22px;">Staff Management Center</h3>
        <button onclick="closeAdvancedStaffManager()" style="background: none; border: none; font-size: 24px; cursor: pointer;">×</button>
      </div>
      
      <div style="margin-bottom: 25px;">
        <h4>Current Active Staff</h4>
        <div id="currentStaffList" style="max-height: 200px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 8px; padding: 10px; background: #f8f9fa;">
        </div>
      </div>
      
      <div style="margin-bottom: 25px; padding: 20px; background: #e8f5e9; border-radius: 10px;">
        <h4>Add New Staff Member</h4>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
          <div>
            <label>Full Name:</label>
            <input type="text" id="newStaffName" placeholder="e.g., Jessica Watts" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
          </div>
          <div>
            <label>Staff ID:</label>
            <input type="text" id="newStaffID" placeholder="e.g., 1008" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
          </div>
        </div>
        <button onclick="addNewStaffMember()" style="background: #28a745; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; width: 100%;">
          Add Staff Member
        </button>
      </div>
      
      <div style="margin-bottom: 20px; padding: 20px; background: #fff3cd; border-radius: 10px;">
        <h4>Archive Staff Member</h4>
        <div style="display: flex; gap: 10px; align-items: end;">
          <div style="flex: 1;">
            <label>Select staff to archive:</label>
            <select id="archiveStaffSelect" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px;">
              <option value="">Choose staff member...</option>
            </select>
          </div>
          <button onclick="archiveStaffMember()" style="background: #ffc107; color: #333; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
            📦 Archive
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions" id="quickActionsPanel" style="display: none;">
    <div class="quick-actions-header" onclick="toggleQuickActions()">
      <span>⚡</span>
    </div>
    <div class="quick-actions-buttons">
      <button onclick="exportToCSV()" class="quick-action-btn">
        <span class="action-icon">📊</span>
        <span class="action-label">Export</span>
      </button>
      <button onclick="refreshData()" class="quick-action-btn">
        <span class="action-icon">🔄</span>
        <span class="action-label">Refresh</span>
      </button>
    </div>
  </div>

<script>
// Constants and Configuration
const BONUS_RATES = {
  enhancement: { tier1: 0.70, tier2: 0.80, tier3: 0.90 },
  membership: { tier1: 10.00, tier2: 15.00, tier3: 20.00 },
  performanceBonus: 20
};

const CONVERSION_CONFIG = { localNonMemberRate: 0.25 };

// Global Variables
let currentUser = null;
let currentPeriod = 'current';

let uploadedData = {
  memberships: null, 
  sales: null, 
  oot: null,
  appointments: null,
  bonus: null,
  payroll: null
};

// Staff passwords with Jessica Watts replacing Mariaelena Parra
const staffPasswords = {
  'Angela McNally': '1001', 'Anna Mercadante': '1004', 'Madison Jeske': '1002',
  'Di Fisher': '1003', 'Edward Franklin': '1005', 'Jessica Watts': '1006'
};

// Staff metadata
const staffMetadata = {
  'Angela McNally': { position: 'EG', weeklyHours: 34, tenure: 14 },
  'Anna Mercadante': { position: 'EG', weeklyHours: 30, tenure: 8 },
  'Madison Jeske': { position: 'EG', weeklyHours: 27, tenure: 12 },
  'Di Fisher': { position: 'EG', weeklyHours: 20, tenure: 3 },
  'Edward Franklin': { position: 'EG', weeklyHours: 36, tenure: 10 },
  'Jessica Watts': { position: 'FD', weeklyHours: 40, tenure: 1 }
};

// Period data with ACTUAL DATA from CSVs - hardcoded for sharing
const periodData = {
  current: {
    'Angela McNally': { enhance: 94, member: 8, eligibleGuests: 32, hours: 68, rebook: 42, totalGuests: 54 },
    'Anna Mercadante': { enhance: 96, member: 13, eligibleGuests: 52, hours: 60, rebook: 38, totalGuests: 48 },
    'Di Fisher': { enhance: 45, member: 1, eligibleGuests: 4, hours: 57, rebook: 25, totalGuests: 46 },
    'Edward Franklin': { enhance: 67, member: 7, eligibleGuests: 28, hours: 72, rebook: 35, totalGuests: 58 },
    'Jessica Watts': { enhance: 7, member: 1, eligibleGuests: 4, hours: 35, rebook: 5, totalGuests: 28 },
    'Madison Jeske': { enhance: 119, member: 3, eligibleGuests: 12, hours: 55, rebook: 35, totalGuests: 44 }
  },
  aug24: {
    'Angela McNally': { enhance: 28, member: 2, eligibleGuests: 8, hours: 68, rebook: 38, totalGuests: 54 },
    'Anna Mercadante': { enhance: 17, member: 1, eligibleGuests: 4, hours: 60, rebook: 35, totalGuests: 48 },
    'Di Fisher': { enhance: 3, member: 0, eligibleGuests: 3, hours: 48, rebook: 28, totalGuests: 38 },
    'Edward Franklin': { enhance: 24, member: 4, eligibleGuests: 16, hours: 72, rebook: 30, totalGuests: 58 },
    'Jessica Watts': { enhance: 0, member: 0, eligibleGuests: 0, hours: 0, rebook: 0, totalGuests: 0 },
    'Madison Jeske': { enhance: 28, member: 2, eligibleGuests: 8, hours: 52, rebook: 32, totalGuests: 42 }
  },
  aug10: {
    'Angela McNally': { enhance: 32, member: 1, eligibleGuests: 4, hours: 65, rebook: 38, totalGuests: 52 },
    'Anna Mercadante': { enhance: 18, member: 1, eligibleGuests: 4, hours: 58, rebook: 35, totalGuests: 46 },
    'Di Fisher': { enhance: 6, member: 0, eligibleGuests: 3, hours: 42, rebook: 28, totalGuests: 34 },
    'Edward Franklin': { enhance: 28, member: 1, eligibleGuests: 4, hours: 70, rebook: 30, totalGuests: 56 },
    'Jessica Watts': { enhance: 0, member: 0, eligibleGuests: 0, hours: 0, rebook: 0, totalGuests: 0 },
    'Madison Jeske': { enhance: 18, member: 1, eligibleGuests: 4, hours: 52, rebook: 32, totalGuests: 42 }
  },
  jul27: {
    'Angela McNally': { enhance: 28, member: 0, eligibleGuests: 3, hours: 70, rebook: 40, totalGuests: 56 },
    'Anna Mercadante': { enhance: 15, member: 0, eligibleGuests: 3, hours: 55, rebook: 33, totalGuests: 44 },
    'Di Fisher': { enhance: 2, member: 0, eligibleGuests: 3, hours: 38, rebook: 22, totalGuests: 30 },
    'Edward Franklin': { enhance: 25, member: 1, eligibleGuests: 4, hours: 68, rebook: 32, totalGuests: 54 },
    'Jessica Watts': { enhance: 0, member: 0, eligibleGuests: 0, hours: 0, rebook: 0, totalGuests: 0 },
    'Madison Jeske': { enhance: 19, member: 1, eligibleGuests: 4, hours: 58, rebook: 34, totalGuests: 46 }
  }
};

let staffData = {};

// Initialize with current period data
function initializeStaffData() {
  // Create sorted array of names first
  const sortedNames = Object.keys(periodData.current).sort((a, b) => a.localeCompare(b));
  
  // Clear existing staffData and rebuild in sorted order
  staffData = {};
  
  sortedNames.forEach(name => {
    const data = periodData.current[name];
    
    // Set current user temporarily to get personalized goal
    const tempUser = currentUser;
    currentUser = name;
    const enhanceGoal = calculateFairEnhancementGoal(data.hours, getStaffTenure(name));
    currentUser = tempUser;
    
    staffData[name] = {
      ...data,
      enhanceGoal: enhanceGoal,
      memberGoal: getConversionGoal(data.eligibleGuests, getStaffTenure(name)),
      prevPerformance: 50,
      tenureMonths: getStaffTenure(name)
    };
  });
}

function getStaffTenure(name) {
  const tenureMap = {
    'Di Fisher': 3, 'Madison Jeske': 12, 'Angela McNally': 14, 'Anna Mercadante': 8,
    'Edward Franklin': 10, 'Jessica Watts': 1
  };
  return tenureMap[name] || 6;
}

function getConversionGoal(eligibleGuests, tenureMonths) {
  const targetRate = CONVERSION_CONFIG.localNonMemberRate;
  return Math.max(Math.round(eligibleGuests * targetRate), 1);
}

function calculateFairEnhancementGoal(hoursWorked, tenureMonths) {
  // More challenging enhancement goals based on individual performance expectations
  // Using staff-specific rates that push for excellence
  
  // Get the current user to apply personalized rates
  const staffRates = {
    'Angela McNally': 1.6,      // Veteran, should maintain high performance
    'Anna Mercadante': 2.8,     // Top performer, highest rate
    'Di Fisher': 1.5,           // Part-time but experienced
    'Edward Franklin': 1.4,     // Full-time, needs improvement
    'Jessica Watts': 0.8,       // New staff, learning curve
    'Madison Jeske': 2.2,       // Star performer
    'Nicole Rice': 0.8          // New staff
  };
  
  // Get the rate for current user, default to 1.2 for unknown staff
  const rate = staffRates[currentUser] || 1.2;
  
  const calculatedGoal = Math.round(hoursWorked * rate);
  
  // Minimum goals based on tenure
  const minimumGoal = tenureMonths >= 3 ? 10 : 5;
  
  return Math.max(calculatedGoal, minimumGoal);
}

function calculateBonus(staffData) {
  if (!staffData || staffData.enhance === undefined || staffData.member === undefined) {
    return { enhanceBonus: 0, membershipBonus: 0, performanceBonus: 0, total: 0 };
  }
  
  // Calculate enhancement goal using the challenging rates
  const staffRates = {
    'Angela McNally': 1.6,
    'Anna Mercadante': 2.8,
    'Di Fisher': 1.5,
    'Edward Franklin': 1.4,
    'Jessica Watts': 0.8,
    'Madison Jeske': 2.2
  };
  
  // Find the staff member name from the data
  let staffName = '';
  Object.keys(staffRates).forEach(name => {
    if (currentUser === name || (staffData === staffData && currentUser === 'admin')) {
      staffName = name;
    }
  });
  
  const rate = staffRates[staffName] || 1.2;
  const enhanceGoal = Math.max(Math.round(staffData.hours * rate), 10);
  const enhancePercent = enhanceGoal > 0 ? (staffData.enhance / enhanceGoal * 100) : 0;
  
  // Adjusted bonus rates for challenging goals
  let enhanceRate = 0;
  if (enhancePercent >= 100) {
    enhanceRate = BONUS_RATES.enhancement.tier3; // 0.90 for exceeding
  } else if (enhancePercent >= 90) {
    enhanceRate = BONUS_RATES.enhancement.tier2; // 0.80 for almost there
  } else if (enhancePercent >= 80) {
    enhanceRate = BONUS_RATES.enhancement.tier1; // 0.70 for close
  } else {
    enhanceRate = 0.50; // Reduced rate for missing goals
  }
  
  const enhanceBonus = staffData.enhance * enhanceRate;
  
  const memberships = staffData.member || 0;
  let membershipBonus = 0;
  if (memberships >= 15) membershipBonus = memberships * BONUS_RATES.membership.tier3;
  else if (memberships >= 10) membershipBonus = memberships * BONUS_RATES.membership.tier2;
  else if (memberships >= 1) membershipBonus = memberships * BONUS_RATES.membership.tier1;
  
  return {
    enhanceBonus: parseFloat(enhanceBonus.toFixed(2)),
    membershipBonus: parseFloat(membershipBonus.toFixed(2)),
    performanceBonus: 0,
    total: parseFloat((enhanceBonus + membershipBonus).toFixed(2))
  };
}

function calculatePerformanceScore(data) {
  if (!data.hours || data.hours === 0) return 0;
  
  const convGoal = getConversionGoal(data.eligibleGuests, data.tenureMonths);
  const actualConv = data.eligibleGuests > 0 ? (data.member / data.eligibleGuests * 100) : 0;
  
  const targetConvRate = 25;
  const convScore = Math.min((actualConv / targetConvRate) * 40, 40);
  const enhancePerHour = data.enhance / data.hours;
  const enhanceScore = Math.min(enhancePerHour * 60, 30);
  const rebookScore = Math.min((data.rebook / 20) * 20, 20);
  const productivityScore = Math.min(((data.member + data.enhance) / data.hours) * 10, 10);
  
  return Math.round(convScore + enhanceScore + rebookScore + productivityScore);
}

function parseCSV(text) {
  const lines = text.split('\n');
  const headers = lines[0].split(',').map(h => h.trim());
  const data = [];
  for (let i = 1; i < lines.length; i++) {
    if (lines[i].trim()) {
      const values = lines[i].split(',');
      const row = {};
      headers.forEach((header, index) => {
        row[header] = values[index] ? values[index].trim() : '';
      });
      data.push(row);
    }
  }
  return data;
}

function showNotification(message, type) {
  const notification = document.createElement('div');
  notification.className = `notification ${type}`;
  notification.textContent = message;
  document.body.appendChild(notification);
  setTimeout(() => notification.remove(), 3000);
}

function loginStaff() {
  const name = document.getElementById('staffSelect').value;
  const password = document.getElementById('staffPassword').value;
  
  if (!name || staffPasswords[name] !== password) {
    showNotification(name ? 'Invalid Staff ID' : 'Please select your name', 'error');
    return;
  }
  
  currentUser = name;
  showStaffDashboard();
  showNotification(`Welcome, ${name}!`, 'success');
}

function loginAdmin() {
  const password = document.getElementById('adminPassword').value;
  if (password === 'admin123') {
    currentUser = 'admin';
    showAdminDashboard();
    showNotification('Admin access granted', 'success');
  } else {
    showNotification('Invalid admin password', 'error');
  }
}

function showStaffDashboard() {
  document.getElementById('loginSection').classList.add('hidden');
  document.getElementById('staffView').classList.remove('hidden');
  document.getElementById('adminView').classList.add('hidden');
  
  const data = staffData[currentUser];
  document.getElementById('staffName').textContent = currentUser;
  
  const convGoal = getConversionGoal(data.eligibleGuests, data.tenureMonths);
  const actualConv = data.eligibleGuests > 0 ? (data.member / data.eligibleGuests * 100) : 0;
  const adjustedEnhanceGoal = calculateFairEnhancementGoal(data.hours, data.tenureMonths);
  
  // Update card values
  document.getElementById('enhanceValue').textContent = data.enhance;
  document.getElementById('enhanceAdjusted').textContent = adjustedEnhanceGoal;
  document.getElementById('memberValue').textContent = data.member;
  document.getElementById('convGoal').textContent = convGoal;
  document.getElementById('rebookValue').textContent = `${data.rebook}%`;
  
  const performanceScore = calculatePerformanceScore(data);
  document.getElementById('overallValue').textContent = `${performanceScore}%`;
  
  const bonusCalc = calculateBonus(data);
  document.getElementById('totalBonus').textContent = `${bonusCalc.total.toFixed(2)}`;
  document.getElementById('enhanceBonus').textContent = `${bonusCalc.enhanceBonus.toFixed(2)}`;
  document.getElementById('membershipBonus').textContent = `${bonusCalc.membershipBonus.toFixed(2)}`;
  
  // Show quick actions panel if it exists
  const quickPanel = document.getElementById('quickActionsPanel');
  if (quickPanel) quickPanel.style.display = 'block';
}

function showAdminDashboard() {
  document.getElementById('loginSection').classList.add('hidden');
  document.getElementById('staffView').classList.add('hidden');
  document.getElementById('adminView').classList.remove('hidden');
  
  const staffArray = Object.values(staffData);
  const totalHours = staffArray.reduce((sum, s) => sum + s.hours, 0);
  
  const avgConv = staffArray.reduce((sum, s) => {
    return sum + (s.eligibleGuests > 0 ? (s.member / s.eligibleGuests * 100) : 0);
  }, 0) / staffArray.length;
  
  const totalBonus = staffArray.reduce((sum, s) => {
    const bonusCalc = calculateBonus(s);
    return sum + bonusCalc.total;
  }, 0);
  
  // Calculate eligible guest totals
  const totalEligibleGuests = staffArray.reduce((sum, s) => sum + (s.eligibleGuests || 0), 0);
  const totalMembersSold = staffArray.reduce((sum, s) => sum + (s.member || 0), 0);
  const goalConversions = Math.round(totalEligibleGuests * 0.25);
  
  document.getElementById('totalHours').textContent = totalHours;
  document.getElementById('avgConvAdmin').textContent = `${avgConv.toFixed(1)}%`;
  document.getElementById('totalTeamBonus').textContent = `${totalBonus.toFixed(2)}`;
  
  // Update eligible guests summary
  document.getElementById('totalEligible').textContent = totalEligibleGuests;
  document.getElementById('goalConversions').textContent = goalConversions;
  document.getElementById('actualConversions').textContent = totalMembersSold;
  
  const performers = Object.entries(staffData)
    .map(([name, data]) => ({ name, score: calculatePerformanceScore(data) }))
    .sort((a, b) => b.score - a.score)
    .slice(0, 3);
  
  document.getElementById('topPerformers').innerHTML = performers
    .map((p, i) => `<li>${p.name} (${p.score}%)</li>`)
    .join('');
  
  let tableHTML = '';
  // Sort staff entries alphabetically by name (A to Z)
  const sortedStaff = Object.entries(staffData).sort((a, b) => {
    return a[0].localeCompare(b[0]);
  });
  
  console.log('Sorted staff order:', sortedStaff.map(s => s[0]));
  
  sortedStaff.forEach(([name, data]) => {
    const performance = calculatePerformanceScore(data);
    const actualConv = data.eligibleGuests > 0 ? (data.member / data.eligibleGuests * 100) : 0;
    
    // Calculate the correct enhancement goal using the new challenging rates
    const staffRates = {
      'Angela McNally': 1.6,
      'Anna Mercadante': 2.8,
      'Di Fisher': 1.5,
      'Edward Franklin': 1.4,
      'Jessica Watts': 0.8,
      'Madison Jeske': 2.2
    };
    
    const rate = staffRates[name] || 1.2;
    const adjustedEnhanceGoal = Math.max(Math.round(data.hours * rate), 10);
    
    const bonusCalc = calculateBonus(data);
    
    tableHTML += `
    <tr>
      <td>${name}</td>
      <td>${data.hours}</td>
      <td>${data.member}</td>
      <td style="color: ${actualConv >= 25 ? '#28a745' : '#dc3545'}">${actualConv.toFixed(1)}%</td>
      <td>25%</td>
      <td>${data.enhance}</td>
      <td>${adjustedEnhanceGoal}</td>
      <td>20%</td>
      <td>${data.rebook}%</td>
      <td>${bonusCalc.total.toFixed(2)}</td>
      <td>${performance}%</td>
    </tr>`;
  });
  
  document.getElementById('teamTableBody').innerHTML = tableHTML;
  document.getElementById('quickActionsPanel').style.display = 'block';
}

function generatePerformanceTips(data, actualConv, convGoal) {
  // This function is no longer used in the new design but kept for compatibility
  return;
}

function changeStaffPeriod() {
  const selector = document.getElementById('staffPeriodSelector');
  const selectedPeriod = selector.value;
  currentPeriod = selectedPeriod;
  
  if (periodData[selectedPeriod] && periodData[selectedPeriod][currentUser]) {
    const data = periodData[selectedPeriod][currentUser];
    staffData[currentUser] = {
      ...data,
      enhanceGoal: calculateFairEnhancementGoal(data.hours, getStaffTenure(currentUser)),
      memberGoal: getConversionGoal(data.eligibleGuests, getStaffTenure(currentUser)),
      prevPerformance: 50,
      tenureMonths: getStaffTenure(currentUser)
    };
    showStaffDashboard();
    showNotification(`Period changed`, 'success');
  }
}

function changePeriod() {
  const selector = document.getElementById('periodSelector');
  const selectedPeriod = selector.value;
  currentPeriod = selectedPeriod;
  
  if (periodData[selectedPeriod]) {
    // Get sorted names
    const sortedNames = Object.keys(periodData[selectedPeriod]).sort((a, b) => a.localeCompare(b));
    
    // Clear and rebuild staffData in sorted order
    staffData = {};
    sortedNames.forEach(name => {
      const data = periodData[selectedPeriod][name];
      staffData[name] = {
        ...data,
        enhanceGoal: calculateFairEnhancementGoal(data.hours, getStaffTenure(name)),
        memberGoal: getConversionGoal(data.eligibleGuests, getStaffTenure(name)),
        prevPerformance: 50,
        tenureMonths: getStaffTenure(name)
      };
    });
    showAdminDashboard();
    showNotification('Period changed', 'success');
  }
}

// File upload handlers
function handleSalesUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      uploadedData.sales = e.target.result;
      const salesStatus = document.getElementById('salesStatus');
      if (salesStatus) salesStatus.innerHTML = '✅ Loaded';
      showNotification('Sales data loaded', 'success');
    };
    reader.readAsText(file);
  }
}

function handleMembershipUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      uploadedData.memberships = e.target.result;
      const membershipStatus = document.getElementById('membershipStatus');
      if (membershipStatus) membershipStatus.innerHTML = '✅ Loaded';
      showNotification('Membership data loaded', 'success');
    };
    reader.readAsText(file);
  }
}

function handleOOTUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      uploadedData.oot = e.target.result;
      const ootStatus = document.getElementById('ootStatus');
      if (ootStatus) ootStatus.innerHTML = '✅ Loaded';
      showNotification('OOT data loaded', 'success');
    };
    reader.readAsText(file);
  }
}

function handleAppointmentsUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      uploadedData.appointments = e.target.result;
      const appointmentStatus = document.getElementById('appointmentStatus');
      if (appointmentStatus) appointmentStatus.innerHTML = '✅ Loaded';
      showNotification('Appointments data loaded', 'success');
    };
    reader.readAsText(file);
  }
}

function handleBonusUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      uploadedData.bonus = e.target.result;
      const bonusStatus = document.getElementById('bonusStatus');
      if (bonusStatus) bonusStatus.innerHTML = '✅ Loaded';
      showNotification('Bonus data loaded', 'success');
    };
    reader.readAsText(file);
  }
}

function handlePayrollUpload(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      uploadedData.payroll = e.target.result;
      const payrollStatus = document.getElementById('payrollStatus');
      if (payrollStatus) payrollStatus.innerHTML = '✅ Loaded';
      showNotification('Payroll data loaded', 'success');
    };
    reader.readAsText(file);
  }
}

// Update membership counts from CSV
function updateMembershipCounts() {
  console.log('Updating membership counts from CSV...');
  
  if (!uploadedData.memberships) {
    showNotification('Please upload Membership data file first', 'error');
    return;
  }
  
  try {
    const membershipData = parseCSV(uploadedData.memberships);
    
    // Update specific staff members we know about
    const updates = {
      'Angela McNally': 0,
      'Anna Mercadante': 0,
      'Di Fisher': 0,
      'Edward Franklin': 0,
      'Jessica Watts': 0,
      'Madison Jeske': 0
    };
    
    // Count memberships for Sept 7-20
    const startDate = new Date(2025, 8, 7);
    const endDate = new Date(2025, 8, 20);
    
    membershipData.forEach(row => {
      const staffName = row['Sold By'];
      if (updates.hasOwnProperty(staffName) && row['Sale Type'] === 'Sale') {
        const dateParts = row['Sale Date'].split('/');
        const saleDate = new Date(2000 + parseInt(dateParts[2]), parseInt(dateParts[0]) - 1, parseInt(dateParts[1]));
        
        if (saleDate >= startDate && saleDate <= endDate) {
          updates[staffName]++;
        }
      }
    });
    
    // Update staffData directly
    Object.keys(updates).forEach(name => {
      if (staffData[name]) {
        staffData[name].member = updates[name];
        console.log(`${name}: ${updates[name]} memberships`);
      }
    });
    
    // Refresh display
    if (currentUser === 'admin') {
      showAdminDashboard();
    }
    
    showNotification('Membership counts updated!', 'success');
    
  } catch (err) {
    console.error('Update error:', err);
    showNotification('Error updating membership counts', 'error');
  }
}

// Update enhancement counts from sales CSV
function updateEnhancementCounts() {
  console.log('Updating enhancement counts from Sales CSV...');
  
  if (!uploadedData.sales) {
    showNotification('Please upload Sales data first', 'error');
    return;
  }
  
  try {
    const salesData = parseCSV(uploadedData.sales);
    console.log('Parsed sales rows:', salesData.length);
    
    // Define date range for current period (Sept 7-20, 2025)
    const startDate = new Date(2025, 8, 7); // Sept 7, 2025
    const endDate = new Date(2025, 8, 20); // Sept 20, 2025
    
    console.log('Filtering enhancements for period:', startDate.toDateString(), 'to', endDate.toDateString());
    
    // Reset enhancement counts for known staff
    const enhancementCounts = {
      'Angela McNally': 0,
      'Anna Mercadante': 0,
      'Di Fisher': 0,
      'Edward Franklin': 0,
      'Jessica Watts': 0,
      'Madison Jeske': 0
    };
    
    // Count enhancements based on Category column and date range
    salesData.forEach(row => {
      const staffName = row['ClosedBy'];
      const category = row['Category'];
      const saleDateStr = row['Sale Date'];
      
      if (staffName && enhancementCounts.hasOwnProperty(staffName) && saleDateStr) {
        // Parse date (format: M/D/YY)
        const dateParts = saleDateStr.split('/');
        if (dateParts.length === 3) {
          const month = parseInt(dateParts[0]);
          const day = parseInt(dateParts[1]);
          const year = 2000 + parseInt(dateParts[2]);
          const saleDate = new Date(year, month - 1, day);
          
          // Check if within date range and is enhancement
          if (saleDate >= startDate && saleDate <= endDate) {
            if (category && category.toLowerCase() === 'enhancement') {
              enhancementCounts[staffName]++;
            }
          }
        }
      }
    });
    
    // Update staffData
    Object.keys(enhancementCounts).forEach(name => {
      if (staffData[name]) {
        staffData[name].enhance = enhancementCounts[name];
        console.log(`${name}: ${enhancementCounts[name]} enhancements`);
      }
    });
    
    // Refresh display
    if (currentUser === 'admin') {
      showAdminDashboard();
    }
    
    showNotification('Enhancement counts updated!', 'success');
    
  } catch (err) {
    console.error('Update error:', err);
    showNotification('Error updating enhancement counts', 'error');
  }
}

// Update rebook rates
function updateRebookRates() {
  if (!uploadedData.appointments) {
    showNotification('Please upload Appointments data first', 'error');
    return;
  }
  
  try {
    // Parse appointments data and calculate rebook rates
    // This is a placeholder - implement actual logic based on your data structure
    showNotification('Rebook rates updated!', 'success');
    if (currentUser === 'admin') {
      showAdminDashboard();
    }
  } catch (err) {
    showNotification('Error updating rebook rates', 'error');
  }
}

// Update payroll hours
function updatePayrollHours() {
  if (!uploadedData.payroll) {
    showNotification('Please upload Payroll data first', 'error');
    return;
  }
  
  try {
    const payrollData = parseCSV(uploadedData.payroll);
    console.log('Processing payroll data...');
    
    // Define the current period dates for matching
    const periodRanges = {
      'current': { start: '9/7/25', end: '9/20/2025', label: 'Sept 7-20' },
      'aug24': { start: '8/24/25', end: '9/6/2025', label: 'Aug 24 - Sep 6' },
      'aug10': { start: '8/10/25', end: '8/23/2025', label: 'Aug 10-23' },
      'jul27': { start: '7/27/25', end: '8/9/2025', label: 'Jul 27 - Aug 9' }
    };
    
    // Get the period we're updating based on current selection
    const targetPeriod = periodRanges[currentPeriod] || periodRanges['current'];
    
    // Reset hours for all staff to 0 first
    Object.keys(staffData).forEach(name => {
      if (staffData[name]) {
        staffData[name].hours = 0;
      }
    });
    
    // Process each payroll row
    let updatedCount = 0;
    payrollData.forEach(row => {
      const employeeName = row['Name'];
      const periodStart = row['Period Start'];
      const periodEnd = row['Period End'];
      const hours = parseFloat(row['Hourly Hr']) || 0;
      
      // Check if this row matches our target period
      if (periodStart && periodStart.includes(targetPeriod.start.split('/').slice(0,2).join('/'))) {
        // Try to match employee name to our staff data
        // Handle variations in name format
        Object.keys(staffData).forEach(staffName => {
          if (employeeName && (
            employeeName.toLowerCase().includes(staffName.toLowerCase()) ||
            staffName.toLowerCase().includes(employeeName.toLowerCase()) ||
            // Handle last name, first name format
            employeeName.toLowerCase().includes(staffName.split(' ')[1]?.toLowerCase()) &&
            employeeName.toLowerCase().includes(staffName.split(' ')[0]?.toLowerCase())
          )) {
            // Add hours (in case of multiple entries for same person/period)
            staffData[staffName].hours += hours;
            updatedCount++;
            console.log(`Updated ${staffName}: +${hours} hours (total: ${staffData[staffName].hours})`);
          }
        });
      }
    });
    
    // Validate hours are reasonable (max 80 hours per 2-week period)
    Object.keys(staffData).forEach(name => {
      if (staffData[name].hours > 80) {
        console.warn(`Warning: ${name} has ${staffData[name].hours} hours - capping at 80`);
        staffData[name].hours = 80;
      }
      // Round to 2 decimal places
      staffData[name].hours = Math.round(staffData[name].hours * 100) / 100;
    });
    
    // Refresh display
    if (currentUser === 'admin') {
      showAdminDashboard();
    } else if (currentUser) {
      showStaffDashboard();
    }
    
    if (updatedCount > 0) {
      showNotification(`Hours updated for ${targetPeriod.label}!`, 'success');
    } else {
      showNotification(`No matching payroll data found for ${targetPeriod.label}`, 'error');
    }
    
  } catch (err) {
    console.error('Payroll update error:', err);
    showNotification('Error updating hours from payroll', 'error');
  }
}

// Staff management functions
function openAdvancedStaffManager() {
  document.getElementById('advancedStaffManager').style.display = 'block';
  
  // Populate current staff list
  const staffListHTML = Object.keys(staffData).sort().map(name => 
    `<div style="padding: 5px; border-bottom: 1px solid #dee2e6;">
      ${name} - ${staffPasswords[name] || 'No ID'}
    </div>`
  ).join('');
  
  document.getElementById('currentStaffList').innerHTML = staffListHTML;
  
  // Populate archive dropdown
  const archiveSelect = document.getElementById('archiveStaffSelect');
  archiveSelect.innerHTML = '<option value="">Choose staff member...</option>';
  Object.keys(staffData).sort().forEach(name => {
    const option = document.createElement('option');
    option.value = name;
    option.textContent = name;
    archiveSelect.appendChild(option);
  });
}

function closeAdvancedStaffManager() {
  document.getElementById('advancedStaffManager').style.display = 'none';
}

function addNewStaffMember() {
  const name = document.getElementById('newStaffName').value.trim();
  const id = document.getElementById('newStaffID').value.trim();
  
  if (!name || !id) {
    showNotification('Please enter both name and ID', 'error');
    return;
  }
  
  // Add to staff passwords
  staffPasswords[name] = id;
  
  // Add to staff data with default values
  staffData[name] = {
    enhance: 0,
    member: 0,
    eligibleGuests: 0,
    hours: 0,
    rebook: 0,
    totalGuests: 0,
    enhanceGoal: 5,
    memberGoal: 1,
    prevPerformance: 0,
    tenureMonths: 1
  };
  
  // Clear inputs
  document.getElementById('newStaffName').value = '';
  document.getElementById('newStaffID').value = '';
  
  showNotification(`${name} added successfully!`, 'success');
  openAdvancedStaffManager(); // Refresh the view
}

function archiveStaffMember() {
  const name = document.getElementById('archiveStaffSelect').value;
  
  if (!name) {
    showNotification('Please select a staff member to archive', 'error');
    return;
  }
  
  delete staffData[name];
  delete staffPasswords[name];
  
  showNotification(`${name} archived successfully!`, 'success');
  openAdvancedStaffManager(); // Refresh the view
}

// Export and utility functions
function exportToCSV() {
  const headers = ['Name', 'Hours', 'Memberships', 'Conv %', 'Enhancements', 'Enh Goal', 'Rebook %', 'Bonus', 'Score'];
  const rows = Object.entries(staffData).map(([name, data]) => {
    const actualConv = data.eligibleGuests > 0 ? (data.member / data.eligibleGuests * 100).toFixed(1) : '0.0';
    const bonusCalc = calculateBonus(data);
    const score = calculatePerformanceScore(data);
    
    return [
      name,
      data.hours,
      data.member,
      actualConv,
      data.enhance,
      data.enhanceGoal,
      data.rebook,
      bonusCalc.total.toFixed(2),
      score
    ].join(',');
  });
  
  const csv = [headers.join(','), ...rows].join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `performance_${currentPeriod}_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  
  showNotification('Data exported successfully!', 'success');
}

function refreshData() {
  if (currentUser === 'admin') {
    showAdminDashboard();
  } else if (currentUser) {
    showStaffDashboard();
  }
  showNotification('Dashboard refreshed!', 'success');
}

function toggleQuickActions() {
  const panel = document.getElementById('quickActionsPanel');
  // Toggle functionality can be added here if needed
}

function logout() {
  currentUser = null;
  document.getElementById('loginSection').classList.remove('hidden');
  document.getElementById('staffView').classList.add('hidden');
  document.getElementById('adminView').classList.add('hidden');
  document.getElementById('quickActionsPanel').style.display = 'none';
  showNotification('Logged out successfully', 'success');
}

// Initialize on page load
window.onload = function() {
  initializeStaffData();
};

// Ensure functions are available globally
window.loginStaff = loginStaff;
window.loginAdmin = loginAdmin;
window.logout = logout;
window.changeStaffPeriod = changeStaffPeriod;
window.changePeriod = changePeriod;
window.handleSalesUpload = handleSalesUpload;
window.handleMembershipUpload = handleMembershipUpload;
window.handleOOTUpload = handleOOTUpload;
window.handleAppointmentsUpload = handleAppointmentsUpload;
window.handleBonusUpload = handleBonusUpload;
window.handlePayrollUpload = handlePayrollUpload;
window.updateMembershipCounts = updateMembershipCounts;
window.updateEnhancementCounts = updateEnhancementCounts;
window.updateRebookRates = updateRebookRates;
window.updatePayrollHours = updatePayrollHours;
window.openAdvancedStaffManager = openAdvancedStaffManager;
window.closeAdvancedStaffManager = closeAdvancedStaffManager;
window.addNewStaffMember = addNewStaffMember;
window.archiveStaffMember = archiveStaffMember;
window.exportToCSV = exportToCSV;
window.refreshData = refreshData;
window.toggleQuickActions = toggleQuickActions;
</script>
</body>
</html>
